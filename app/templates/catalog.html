{% extends "base.html" %}
{% import "_macros.html" as macros %}

{% block title %}Women's Activism NYC{% endblock %}

{% block page_content %}
    {% block tags %}
        {% include "_tags.html" %}
    {% endblock %}
{% endblock %}

{% block scripts %}
    {{ super() }}
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">
    <script type="text/javascript">
        function get_tags(tag_name) {
            var tag_list = [];  // initialize list of tags to pass to view function
            var tag_button = document.getElementsByName(tag_name)[0];  // get html of button clicked
            var all_filters = document.getElementsByClassName("active");  // get NodeList of active buttons before button press
            if (tag_button.getAttribute("aria-pressed") == "false") {  // check if button pressed was not active before
                tag_list.push(tag_button.name);  // add tag name of button to tag list
            }
            for (var i = 0; i < all_filters.length; i++) {  // loop through NodeList of all active buttons before button press
                tag_list.push(all_filters[i].value);  // add tag names of all active buttons to tag list
            }
            if (tag_button.getAttribute("aria-pressed") == "true") {  // check if button pressed was active before
                var index = tag_list.indexOf(tag_button.name);  // find index of tag name in tag list
                tag_list.splice(index, 1);  // remove tag name of button from tag list
            }
            $.ajax({  // ajax request sending list of tags to _get_tags function, returns html of _filtered_stories.html
                type: "POST",
                url: '/_get_tags',
                dataType: 'html',
                data: JSON.stringify(tag_list),
                success: function (response) {
                    var filtered_stories = $('#filtered-stories');
                    filtered_stories.html(response);
                },
                error: function (error) {
                    console.log(error);
                }
            })
        }
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            var sort_options = ['A-Z First Name', 'Z-A First Name', 'A-Z Last Name', 'Z-A Last Name'];
            var active_buttons = document.getElementsByClassName('btn btn-primary active');  // grabs all tag buttons selected previously
            for (var i = 0; i < active_buttons.length; i++) {  // loops through list of previously selected tags
                if (sort_options.indexOf(active_buttons[i].id) >= 0) {
                    $('<input>').attr({
                        type: 'hidden',
                        value: active_buttons[i].value,
                        name: "sort_option",
                        id: "sort_option_" + active_buttons[i].value
                    }).appendTo('form');  // add a hidden input field with value of the tag pressed
                } else {
                    $('<input>').attr({
                        type: 'hidden',
                        value: active_buttons[i].value,
                        name: "category_button",
                        id: "category_button_" + active_buttons[i].value
                    }).appendTo('form');  // add a hidden input field with value of the tag pressed
                }
            }
        });
    </script>
    <script type="text/javascript">
        function category_button_click(tag_name) {
            var category_button = document.getElementById(tag_name);  // get button being pressed
            if (category_button.getAttribute("aria-pressed") == "false") {  // check if the button was previously not active
                $('<input>').attr({
                    type: 'hidden',
                    value: tag_name,
                    name: "category_button",
                    id: "category_button_" + tag_name
                }).appendTo('form');  // add a hidden input field with value of the tag pressed
            }
            if (category_button.getAttribute("aria-pressed") == "true") {  // check if button was previously active
                var hidden_category_button = document.getElementById("category_button_" + tag_name);  // get hidden input field that was created
                hidden_category_button.remove();  // remove hidden input field
            }
        }
    </script>
    <script>
    $(".btn-group > .btn").click(function() {
        if (this.getAttribute("class") != "btn btn-primary active") {
            $(this).addClass("active").siblings().removeClass("active");
            for (var i = 0; i < $(this).siblings().length; i++) {  // loops through list of other buttons in btn-group
                console.log(document.getElementById("sort_option_" + $(this).siblings()[i].getAttribute("id")));
                var remove_sorting_option = document.getElementById("sort_option_" + $(this).siblings()[i].getAttribute("value"));
                if (remove_sorting_option != null) {
                    remove_sorting_option.remove();  // removes other active button hidden inputs
                }
            }
            $('<input>').attr({
                type: 'hidden',
                value: this.getAttribute("value") || '',
                name: "sort_option",
                id: "sort_option_" + this.getAttribute("value")
            }).appendTo('form');  // add a hidden input field with value of the tag pressed
        } else {
            $(this).removeClass("active");
            var hidden_sorting_option = document.getElementById("sort_option_" + this.getAttribute("value"));  // get hidden input field that was created
            hidden_sorting_option.remove();  // remove hidden input field
        }
    });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/i18n/defaults-*.min.js"></script>
{% endblock %}
